--- claude-wrapper-ultimate.sh	2025-08-25
+++ claude-wrapper-fixed.sh	2025-08-25
@@ -22,11 +22,24 @@
 # Don't exit on errors - handle them gracefully
 set +e
 
-# Suppress verbose agent bridge headers
-export CLAUDE_QUIET_MODE=true
-export CLAUDE_SUPPRESS_BANNER=true
-export NO_AGENT_BRIDGE_HEADER=true
-export CLAUDE_BRIDGE_QUIET=true
-export DISABLE_AGENT_BRIDGE=true
+# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
+# OUTPUT CONTROL - CONFIGURABLE (FIXED)
+# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
+
+# Allow user to control output suppression via environment variable
+# Default to NOT suppressing output to fix bash output issues
+if [[ "${CLAUDE_FORCE_QUIET:-false}" == "true" ]]; then
+    # Only suppress if explicitly requested
+    export CLAUDE_QUIET_MODE=true
+    export CLAUDE_SUPPRESS_BANNER=true
+    export NO_AGENT_BRIDGE_HEADER=true
+    export CLAUDE_BRIDGE_QUIET=true
+    export DISABLE_AGENT_BRIDGE=true
+else
+    # Default: Allow normal output
+    export CLAUDE_QUIET_MODE=false
+    export CLAUDE_SUPPRESS_BANNER=false
+    # Still suppress verbose headers but allow actual output
+    export NO_AGENT_BRIDGE_HEADER=true
+    export CLAUDE_BRIDGE_QUIET=false
+    export DISABLE_AGENT_BRIDGE=false
+fi

@@ -341,16 +354,19 @@ execute_claude() {
     
     log_debug "Executing: $claude_binary ${args[*]}"
     
+    # FIXED: Don't use exec which replaces the shell process
+    # Instead, run normally to preserve output handling
+    
     # Method 1: Try direct execution
     if [[ -x "$claude_binary" ]]; then
-        exec "$claude_binary" "${args[@]}" 2>&1
+        "$claude_binary" "${args[@]}"
+        return $?
     fi
     
     # Method 2: Try with node
     if command_exists node; then
-        exec node "$claude_binary" "${args[@]}" 2>&1
+        node "$claude_binary" "${args[@]}"
+        return $?
     fi
     
     # Method 3: Try with npx
     if command_exists npx; then
-        exec npx @anthropic-ai/claude-code "${args[@]}" 2>&1
+        npx @anthropic-ai/claude-code "${args[@]}"
+        return $?
     fi